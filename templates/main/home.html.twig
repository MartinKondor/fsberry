{% extends 'base.html.twig' %}

{% block title %}Home{% endblock %}
{% block stylesheets %}{% endblock %}

{% block body %}
   <section id="quote"></section>
   <section class="newpost-card">
   {% if user is defined %}
      <form action="{{ asset('auth/newpost') }}" method="POST">
         <textarea class="form-control mb-1" name="postContent" placeholder="Share something ..." required></textarea>
         <button type="submit" class="btn btn-primary btn-block">Share</button>
      </form>
   {% else %}
      <p class="text-center h1 mt-2">Please log in for sharing a post.</p>
   {% endif %}
   </section>
   <section class="row">
      <div class="col-lg-7">
         {% if posts is defined %}
         {% for post in posts %}
            <article class="post animated">
               <div class="post-title">
                  <span class="uploader">
                     <img class="img-responsive xs-profile" src="{{ asset("images/profiles/" ~ post.uploader_profile_pic) }}" alt="Profile icon of {{ post.uploader }},">
                     <a href="{{ asset('u/' ~ post.uploader_link) }}">{{ post.uploader }}</a>
                  </span>
                  <span class="post-time">{{ post.time }}</span>
               </div>
               <p class="post-content">{{ post.content }}</p>
               <div class="post-info">
                  {% if user is defined %}
                     <a class="upvote-icon feed-icon" href="{{ asset('auth/upvote-' ~ post.post_id) }}" title="Upvote this post">
                     {% if post.upvotedByUser %}
                        <i class="fas fa-thumbs-up"></i>
                     {% else %}
                        <i class="far fa-thumbs-up"></i>
                     {% endif %}
                     {{ post.upvotes }}
                     </a> 
                     &middot;
                  {% endif %}
                  <a id="{{ 'post-' ~ post.post_id ~ '-link'}}" class="feed-icon comment-link" href="#" title="Show the comments of this post"><i class="far fa-comment"></i> {{ post.comments | length }}</a>
               </div>
               <div id="{{ 'post-' ~ post.post_id ~ '-comments' }}" class="post-comments animated fadeIn" style="display:none;">
               {% if user is defined %}
                  <form action="{{ asset('p/auth/newcomment') }}" method="POST">
                     <div class="input-group">
                        <textarea height="42" class="form-control" name="comment" placeholder="Write a comment here ..." required></textarea>
                        <input style="display:none;" type="text" name="postid" value="{{ post.post_id }}">
                        <div class="input-group-append">
                           <button type="submit" class="btn btn-primary send-comment">Send</button>
                        </div>
                     </div>
                  </form>
               {% endif %}
                  {% if post.comments is not null %}
                     {% for comment in post.comments %}
                        <div class="comment">
                           <div>
                              <a href="{{ asset('u/' ~ comment.commenterLink) }}" class="comment-commenter">
                                 <img class="xxs-profile" src="{{ asset('images/profiles/' ~ comment.commenterProfile) }}" alt="Profile picture of {{ comment.commenter }},">
                                 {{ comment.commenter }}
                              </a>
                              &middot;
                              <span class="comment-time">{{ comment.time }}</span>
                           </div>
                           <span class="comment-content">{{ comment.comment }}</span>
                        </div>
                     {% endfor %}
                  {% else %}
                     <p class="h3 mt-1">There are no comments on this post...</p>
                     {% if user is defined %}
                        <p>Be the first to comment on it</p>
                     {% endif %}
                  {% endif %}
               </div>
            </article>
         {% endfor %}
      {% else %}
         <h1 class="mx-5 my-5">There are no post's to show!</h1>
         <p style="margin-bottom:500px !important;">Please come back later ...</p>
      {% endif %}
      </div>
      <div class="col-lg-5 animated fadeIn community-row">
         <div class="affix">
            Teams, chat ...
         </div>
      </div>
   </section>  
{% endblock %}

{% block javascripts %}
<script src="{{ asset('javascripts/quote.js') }}"></script>
{% endblock %}